{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    {%comment%} Checks if use is logged in  {%endcomment%}
    {% if user.is_authenticated %}
    
      <h1>
        Hi {{ user.username }}, {{ user.email }}
      </h1> 
      <div class="container my-5">
      <div class="shadow-lg p-3 mb-5 bg-white rounded">
        <table class="table table-striped ">
          <thead class="thead-dark">
            <tr>
                <th scope="col">Customer Id</th>
                <th scope="col">Appoitment Day</th>
                <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>     
    {% else %}
      <p>You are not logged in</p>
      <a href="{% url 'login' %}">login</a>
    {% endif %}
    <script>
      fetch('http://127.0.0.1:8000/appointment')
        .then(res => {
          return res.json();
        })
        .then(data =>{
          data.forEach(appoitment=> {
            console.log(data)
            const markup = `<tr>
                            <td>${appoitment.customer_id}</td>
                            <td>${appoitment.day}</td>
                            <td><button type="submit" class="btn btn-primary">Appoitment Complete</button> <button type="submit" class="btn btn-danger">Cancel Appoitment</button></td>
                            </tr>`
            document.querySelector('tbody').insertAdjacentHTML('beforeend',markup)
          });
        })
        .catch(error => console.log(error));
    </script>
{% endblock %}
